<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html>	<head>		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">		<title>HoDoor</title>		<link rel="stylesheet" type="text/css" media="screen" href="css/smoothness/jquery-ui-1.10.4.custom.css" />		<link rel="stylesheet" href="css/magnific-popup.css"> 		<link href='http://fonts.googleapis.com/css?family=Germania+One' rel='stylesheet' type='text/css'>		<link href='http://fonts.googleapis.com/css?family=Diplomata+SC' rel='stylesheet' type='text/css'>		<link href='http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz:400,300,700' rel='stylesheet' type='text/css'>				<style>			html, body {				margin: 0;				padding: 0;				height:100%;				font-family: Arial, Helvetica, sans-serif			}						.logentry {				line-height:35px;				color: #bb0f0f;				font-weight: normal;				font-family: 'Yanone Kaffeesatz', sans-serif;			}						.logentry:hover {				font-size: 120%;				color: #ff5252;				line-height:60px;			}						.log {				font-size: 200%;				float: left;				display: table-cell;				vertical-align: bottom;			}						.open {				float: left;				font-weight: bold;				display: table-cell;				vertical-align: middle;				font-size: 200%;				margin-left: 10px;				margin-right: 10px;				color: #f01515;				font-family: 'Yanone Kaffeesatz', sans-serif;			}						.closed {				float: left;				font-weight: bold;				display: table-cell;				vertical-align: middle;				font-size: 200%;				margin-left: 10px;				margin-right: 10px;				color: #a31616;				font-family: 'Yanone Kaffeesatz', sans-serif;			}						.title-container {				position: absolute;				top: 0; 				height: 100px;				width: 100%;			}						.title-inner {				position: absolute;				bottom: 10px;				left:100px;				right:200px;				font-size:300%; 				font-weight:bold; 				font-family: 'Germania One', cursive;			}						.inner-container {				postition:relative; 				width:1600px;				margin:auto;			}						.history-image-container {				postition:relative; 			}						.outer-container {				position: absolute;				top:100px;				height: 600px;				left:0px;				right:0px;				background: #890c0c;			}						.status {				float:left;				color:white;				margin-top: 200px;				margin-left: 60px;				height:100%;				display:table;			}						.active {				color: white;				font-size:120%;				line-height:60px;			}						.status p {				display: table-cell; 				vertical-align: middle; 				text-align: center; 				font-family: 'Diplomata SC', cursive;				font-size: 200%;			}						.history {				height: 500px;				margin-top: 100px;				margin-left: 90px;				width: 650px;				float:left;				border-radius: 6px;			}						.event-history-image {				height: 144px;				width:192px;				margin: 10px; 			}			.history-content {				height: 80%;				overflow: auto;				color: #bb0f0f;			}						.image-set {				display:none;				width:800px;				margin-left: auto;				margin-right: auto;			}			.eye img {				height:56px;				width:90px;			}			.eye:hover img {				height:62px;				width:100px;			}					</style>				<script type="text/javascript" src="/webiopi.js"></script>		<script src="js/jquery-2.1.0.min.js" type="text/javascript"></script>		<script src="js/jquery.timeago.js" type="text/javascript"></script>		<script src="js/jquery.magnific-popup.min.js"></script> 	</head>	<body >		<div class="title-container">			<div class="title-inner">				<div style="position:absolute; bottom:0px;"><img height="40px" width="60px" src="img/HoDoor-Logo-NoText.png"></div>				<div style="position:absolute; bottom:-10px; left:70px">HoDoor</div>				<div style="font-family: 'Yanone Kaffeesatz', sans-serif; position:absolute; bottom:-10px; right:0px; font-size: 40%">					<div style="float:left">Last updated&nbsp;</div> 					<div style="float:left" id="updatedate">2014-02-09</div>					<div style="float:left">&nbsp; at &nbsp;</div>					<div style="float:left" id="updatetime"> 12:12pm</div>				</div>							</div>		</div>		<div class="outer-container">			<div class="inner-container">				<div style="float:left"><img src="img\HoDoorBackgrdFiltered.png"></div>				<div class="status">					<div id="controls"></div>					<div style="width:150px; margin-top:50px; margin-left: auto; margin-right: auto;">						<div id="eye" class='eye'><center><img src="img\eye-con.png"></center></div>						<div id="progress" style="display:none" ><center><img height=50px; width=50px; src="img\progress_bar.gif"></center></div>						<div id="looksee" style="display:none"><center>Have a looksee<center></div>					</div>				</div>				<div class="history">					<div id="historyContent" class="history-content"></div>				</div>				</div>			<div style='clear:both'></div>			<div class="history-image-container" id="image-container"></div>		</div>	</body>	<script type="text/javascript"> 		$( document ).ready(function($) {			$('#eye').hover(function() {				$('#looksee').toggle();			});			$('#eye').click(function() {				$('#eye').toggle();				$('#progress').toggle();								webiopi().callMacro("getCurrentImage", [], getCurrentImageCallback);			});			refresh();			function activate_timeago(el){				$(el).each(function(){					if (!$(this).hasClass('processed')){						$(this).timeago();						$(this).addClass('processed');   					}				});			}							function formatAMPM(date) {			  var hours = date.getHours();			  var minutes = date.getMinutes();			  var ampm = hours >= 12 ? 'pm' : 'am';			  hours = hours % 12;			  hours = hours ? hours : 12; // the hour '0' should be '12'			  minutes = minutes < 10 ? '0'+minutes : minutes;			  var strTime = hours + ':' + minutes + ' ' + ampm;			  return strTime;			}			function historyCallback(macro, args, data) {				var events = eval(data);				$.each( events, function( index, event ){					var eventdate = new Date(event.date);					var appendString = "<div class='logentry' id='" + event.eventId + "'><div class='log'>The door was </div>";					if(event.state == 1){						appendString += "<div class='open'> opened </div>";					}					else					{						appendString += "<div class='closed'> closed </div>";					}					appendString +=  "<div class='log'> <abbr class='new' title='" +  event.date + "'>" + event.date + "</abbr> at " + formatAMPM(eventdate) + "</div><div style='clear:both'></div>"; 					$("#historyContent").append(appendString);					if(event.state == 1){						var eventIdParam = [event.eventId];						webiopi().callMacro("getImagesForEvent", eventIdParam, getImagesCallback);					}				});				var elements = $('#historyContent .new');				activate_timeago(elements);				$( "div.logentry" ).click(function() {					$( "div.logentry" ).removeClass("active");					$(this).addClass("active");					eventClicked($(this).attr("id"));				});								var now = new Date(); 				var refreshDate = now.toLocaleString();				$("#updatedate").html("<abbr id='updatedateid' title='" +  refreshDate + "'>" + refreshDate + "</abbr>");				$("#updatetime").html("<abbr id='updatedateid' title='" +  formatAMPM(now) + "'>" + formatAMPM(now) + "</abbr>");				$("#updatedateid").timeago();			}						function refresh(){				webiopi().setFunction(2, 'IN');				webiopi().digitalRead(2, gpioReadCallback); 				var count = [8];				webiopi().callMacro("getRecords", count, historyCallback);			}			function gpioReadCallback(gpio, value) {			  if(value == 1){				$("#controls").html("<p>The door<br>is<br><b>OPEN<b></p>");			  }			  else 			  {				$("#controls").html("<p>The door<br>is<br>closed</p>");			  }			}						function getImagesCallback(macro, args, data) {				var evalData = eval(data);				var appendString = "<div id='imageSet" + args[0] + "' class='image-set'>";				$.each( evalData, function( index, imageLoc ){					appendString += "<a href='http://hodoor.squishyfacesoftware.com:8000/ImageCapture/" + imageLoc + "'><img class='event-history-image' src='http://hodoor.squishyfacesoftware.com:8000/ImageCapture/" + imageLoc + "'></a>";				});				appendString += "</div>";				$("#image-container").append(appendString);			}						function getCurrentImageCallback(macro, args, data) {				$('#progress').toggle();				$('#eye').toggle();							$.magnificPopup.open({				  items: {					src: 'http://hodoor.squishyfacesoftware.com:8000/ImageCapture/' + data				  },				  type: 'image'				}, 0);			}			function eventClicked(id){				$('div.image-set').hide();				$("#imageSet"+id).show();				$('div.image-set').magnificPopup({				  delegate: 'a', // child items selector, by clicking on it popup will open				  type: 'image'				});			}		});	</script> </html>